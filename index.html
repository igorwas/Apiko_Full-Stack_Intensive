<!DOCTYPE html>
<html>
<head>
	<title>Apiko Intensive. Homework. AdvancedJS</title>
	<link rel="stylesheet" type="text/css" href="css/style.css">
</head>
<body>
	<ul id="posts">

	</ul>
    <script>
    	const API_POSTS = 'https://jsonplaceholder.typicode.com/posts/';
    	const API_COMMENTS_BASE = 'https://jsonplaceholder.typicode.com/comments?postId=';
 		const API_POSTS_BY_AUTHOR_BASE = 'https://jsonplaceholder.typicode.com/posts?userId=';
    	
    	checkParameters();
    

		function checkParameters(){
			let parameters = (new URL(document.location)).searchParams;
		    if (parameters.get('postId')) {
				showSinglePost(parameters.get('postId'));
			} else if(parameters.get('userId')) {
				getPosts(API_POSTS_BY_AUTHOR_BASE + parameters.get('userId'));
			} else {
				getPosts(API_POSTS);
			}
		}

		function showSinglePost(postId){
			getPosts(`${API_POSTS}${postId}`);
			document.write("<h3>Comments</h3><ul id='comments';></ul>");
			getComments(`${API_COMMENTS_BASE}${postId}`);
		}

		function getPosts(url){
    		fetch(url)
			.then(response => response.json())
			.then(json => {
				document.getElementById("posts").innerHTML=" ";
				if(json.length > 0){
					json.forEach((element) => {
						showPost(element);
					})
				} else {
					showPost(json);
				}
				
			})
		    .catch(error => console.error(error));
    	}

    	function showPost(post){
    		let postsList = document.getElementById("posts");
    		let postsItem = document.createElement('li');
     	 	postsItem.innerHTML = `<h2><a onclick="checkParameters()" href="?postId=${post.id}" >Post #${post.id}.${post.title}</a></h2>
     	 		<p>${post.body}</p><a onclick="checkParameters()" href="?userId=${post.userId}" >Author #${post.userId}</a>`;
      		postsList.appendChild(postsItem);
    	}

    	function getComments(url){
    		fetch(url)
			.then(response => response.json())
			.then(json => {
				console.log(json);
				if(json.length > 0){
					json.forEach( (element) => {
						showComment(element);
					})
				} else {
					showComment(json);
				}
				
			})
		    .catch(error => console.error(error));
    	}

    	function showComment(comment){
    		let commentsList = document.getElementById("comments");
    		let commentItem = document.createElement('li');
     	 	commentItem.innerHTML = `<h4>${comment.name}.</h4><a href="mailto:${comment.email}">${comment.email}</a><p>${comment.body}</p>`;
      		commentsList.appendChild(commentItem);
    	}
    </script>
</body>
</html>